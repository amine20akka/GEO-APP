<div
    class="fixed bottom-0 top-0 w-full sm:w-96 lg:sticky lg:left-full lg:h-screen lg:w-16 lg:shadow"
>
    <div
        class="bg-card flex h-full w-full flex-col transition-transform duration-400 ease-drawer sm:w-96"
        [ngClass]="{
            '-translate-x-full shadow sm:-translate-x-96 lg:-translate-x-80':
                opened,
            'translate-x-0': !opened,
        }"
    >
        <!-- Header -->
        <div
            class="quick-chat-header flex flex-0 cursor-pointer items-center justify-start"
            (click)="toggle()"
        >
            <!-- Toggle -->
            @if (!opened || (opened && !selectedLayer)) {
                <div class="flex flex-auto items-center justify-center">
                    <div class="flex w-16 flex-0 items-center justify-center">
                        <mat-icon
                            class="icon-size-6"
                            [svgIcon]="
                                'layers'
                            "
                        ></mat-icon>
                    </div>
                    <div class="text-secondary text-lg font-medium">
                        Layers
                    </div>
                    <button class="ml-auto mr-4" mat-icon-button>
                        <mat-icon
                            [svgIcon]="'heroicons_outline:x-mark'"
                        ></mat-icon>
                    </button>
                </div>
            }

            <!-- layer info -->
            @if (opened && selectedLayer) {
                <div class="ml-3 flex flex-auto items-center">
                    <div
                        class="relative flex h-10 w-10 flex-0 items-center justify-center"
                    >
                        
                            <div
                                class="flex h-full w-full items-center justify-center rounded-full bg-gray-200 text-lg uppercase text-gray-600 dark:bg-gray-700 dark:text-gray-200"
                            >
                                {{ selectedLayer.name.charAt(0) }}
                            </div>
                        
                    </div>
                    <div class="ml-4 truncate text-lg font-medium leading-5">
                        {{ selectedLayer.name }}
                    </div>
                    <button class="ml-auto mr-4" mat-icon-button>
                        <mat-icon
                            [svgIcon]="'heroicons_outline:x-mark'"
                        ></mat-icon>
                    </button>
                </div>
            }
        </div>

        <!-- Content -->
        <div class="flex flex-auto overflow-hidden border-t">
            <!-- layers list -->
            <div
                class="h-full w-16 flex-0 overflow-y-auto overscroll-y-contain sm:overflow-hidden sm:overscroll-auto"
                fuseScrollbar
                [fuseScrollbarOptions]="{ wheelPropagation: false }"
            >
                <div class="flex-auto">
                    
                    <div class="flex-auto">
        @for (layer of layers; track trackByFn($index, layer); let i = $index) {
            <div
                class="relative"
                [attr.data-index]="i"
            >
                <div
                    class="h-2 w-full transition-all duration-200 ease-in-out"
                    [ngClass]="{'bg-blue-200 h-4': draggedOverIndex === i}"
                ></div>
                <div
                    class="flex cursor-move items-center px-4 py-3 transition-all duration-200 ease-in-out"
                    [ngClass]="{
                        'hover:bg-gray-100 dark:hover:bg-gray-700': !selectedLayer || selectedLayer.name !== layer.name,
                        'bg-primary-50 dark:bg-gray-600': selectedLayer && selectedLayer.name === layer.name,
                        'opacity-50': draggedIndex === i
                    }"
                    (click)="selectLayer(layer)"
    draggable="true"
    (dragstart)="onDragStart($event, i)"
    (dragend)="onDragEnd($event)"
    (dragover)="onDragOver($event, i)"
    (dragleave)="onDragLeave()"
    (drop)="onDrop($event, i)"
                >
                    <div class="flex h-10 w-10 items-center justify-center rounded-full bg-gray-200 text-lg font-semibold uppercase text-gray-600 dark:bg-gray-700 dark:text-gray-200 shadow-sm">
                        {{ layer.name.charAt(0) }}
                    </div>
                </div>
            </div>
        }
    </div>
                </div>
                
                <button mat-icon-button
    class="absolute bottom-4 right-4 bg-red-500 text-white"
    [ngClass]="{'hidden': !isDragging}"
    (dragover)="onDragOverDelete($event)"
    (dragleave)="onDragLeaveDelete($event)"
    (drop)="onDropDelete($event)"
>
    <mat-icon>delete</mat-icon>
</button>
            </div>

            <!-- layer management -->
            <div class="flex flex-auto flex-col overflow-hidden border-l bg-gray-50 dark:bg-transparent">
                @if (selectedLayer) {
                    <div class="flex flex-col h-full">
                        <!-- Map Display -->
                        <div class="flex-1 p-4">
                            <div>Layer Visualizer</div>
                            <div>
                                <p>Name: {{ selectedLayer.name }}</p>
                                <p>Opacity: {{ selectedLayer.opacity | percent }}</p>
                                <p>Color: {{ selectedLayer.color }}</p>
                                <!-- Add other properties as needed -->
                            </div>
                        </div>
                
                        <!-- Horizontal Menu and Controls -->
                        <div class="flex flex-col bg-gray-50 dark:bg-gray-800 p-4">
                            <!-- Tabs -->
                            <ul class="flex border-b">
                                <li class="mr-1">
                                    <a class="bg-white inline-block py-2 px-4 text-blue-500 hover:text-blue-800 font-semibold" (click)="setActiveTab('color')">Color</a>
                                </li>
                                <li class="mr-1">
                                    <a class="bg-white inline-block py-2 px-4 text-blue-500 hover:text-blue-800 font-semibold"  (click)="setActiveTab('opacity')">Opacity</a>
                                </li>
                            </ul>
                
                            <!-- Tab Content -->
                            <div class="py-4">
                                <!-- Color Picker -->
                                @if (activeTab === 'color') {
                                    <div class="color-picker-container">
                                        <app-advanced-color-picker 
                                            [(color)]="selectedLayer.color"
                                            (colorChange)="updateLayerColor($event)">
                                        </app-advanced-color-picker>
                                    </div>
                                }
                
                                <!-- Opacity Setter -->
                                @if (activeTab === 'opacity') {
                                    <div class="opacity-setter-container">
                                        <input 
                                            type="range" 
                                            min="0" 
                                            max="1" 
                                            step="0.01" 
                                            [(ngModel)]="selectedLayer.opacity"
                                            (input)="updateLayerOpacity($event)"
                                            class="w-full"
                                        >
                                        <div class="text-center mt-2">
                                            Opacity: {{ selectedLayer.opacity | percent }}
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                }
                @else {
                    <div class="flex h-full w-full flex-auto flex-col items-center justify-center p-4">
                        <mat-icon class="icon-size-24" [svgIcon]="'layers'"></mat-icon>
                        <div class="text-secondary mt-4 text-center text-xl font-medium tracking-tight">
                            Select a Layer
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>



